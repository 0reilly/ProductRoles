{"ast":null,"code":"import _regeneratorRuntime from\"/root/productroles/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/productroles/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/root/productroles/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useHistory}from\"react-router-dom\";import\"../App.css\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";var CheckoutForm=function CheckoutForm(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];var stripe=useStripe();var elements=useElements();var history=useHistory();useEffect(function(){window.scrollTo(0,0);},[]);var cardStyle={style:{base:{color:\"#32325d\",fontFamily:'Arial, sans-serif',fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#32325d\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};var handleChange=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setDisabled(event.empty);setError(event.error?event.error.message:\"\");case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleChange(_x){return _ref.apply(this,arguments);};}();var paymentIntent=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();window.fetch(\"http://localhost:3001/create-payment-intent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({items:[{price:props.price}]})}).then(function(res){return res.json();}).then(function(data){console.log(\"payment intent created\"+data.clientSecret);handleSubmit(data.clientSecret);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function paymentIntent(_x2){return _ref2.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(clientSecret){var payload;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"confirming payment\");setProcessing(true);_context3.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}});case 4:payload=_context3.sent;if(payload.error){setError(\"Payment failed \".concat(payload.error.message));setProcessing(false);}else{setError(null);setProcessing(false);setSucceeded(true);handleForm();}case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSubmit(_x3){return _ref3.apply(this,arguments);};}();var goHome=function goHome(){history.push(\"/\");};var handleForm=function handleForm(){props.form();};return/*#__PURE__*/React.createElement(\"form\",{id:\"payment-form\",onSubmit:paymentIntent},/*#__PURE__*/React.createElement(CardElement,{id:\"card-element\",options:cardStyle,onChange:handleChange}),/*#__PURE__*/React.createElement(\"div\",{className:succeeded?\"p-4 row justified-content-center result-message hidden\":\"p-4 row justified-content-center result-message\"},/*#__PURE__*/React.createElement(\"button\",{disabled:processing||disabled||succeeded,className:\"col btn btn-primary\"},/*#__PURE__*/React.createElement(\"span\",{id:\"button-text\"},processing?/*#__PURE__*/React.createElement(\"div\",{className:\"spinner\",id:\"spinner\"}):\"Post Job Ad\",\" $\",props.price/100))),error&&/*#__PURE__*/React.createElement(\"div\",{className:\"card-error\",role:\"alert\"},error),/*#__PURE__*/React.createElement(\"div\",{className:succeeded?\"p-4 justify-content-center result-message\":\"p-4 justify-content-center result-message hidden\"},/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\",onClick:goHome},\"Home.\")),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"p\",null,\"Payment succeeded! View your new listing on the Home page! An order summary will be emailed to you.\"))));};export default CheckoutForm;","map":{"version":3,"sources":["/root/productroles/client/src/components/CheckoutForm.jsx"],"names":["React","useState","useEffect","useHistory","CardElement","useStripe","useElements","CheckoutForm","props","succeeded","setSucceeded","error","setError","processing","setProcessing","disabled","setDisabled","clientSecret","setClientSecret","stripe","elements","history","window","scrollTo","cardStyle","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","handleChange","event","empty","message","paymentIntent","e","preventDefault","fetch","method","headers","body","JSON","stringify","items","price","then","res","json","data","console","log","handleSubmit","confirmCardPayment","payment_method","card","getElement","payload","handleForm","goHome","push","form"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport {useHistory} from \"react-router-dom\"\nimport \"../App.css\";\nimport {\n    CardElement,\n    useStripe,\n    useElements\n} from \"@stripe/react-stripe-js\";\n\nconst CheckoutForm = (props) => {\n    const [succeeded, setSucceeded] = useState(false);\n    const [error, setError] = useState(null);\n    const [processing, setProcessing] = useState('');\n    const [disabled, setDisabled] = useState(true);\n    const [clientSecret, setClientSecret] = useState('');\n    const stripe = useStripe();\n    const elements = useElements();\n    let history = useHistory();\n\n    useEffect(() => {\n        window.scrollTo(0, 0);\n    }, []);\n\n    const cardStyle = {\n        style: {\n            base: {\n                color: \"#32325d\",\n                fontFamily: 'Arial, sans-serif',\n                fontSmoothing: \"antialiased\",\n                fontSize: \"16px\",\n                \"::placeholder\": {\n                    color: \"#32325d\"\n                }\n            },\n            invalid: {\n                color: \"#fa755a\",\n                iconColor: \"#fa755a\"\n            }\n        }\n    };\n    const handleChange = async (event) => {\n        setDisabled(event.empty);\n        setError(event.error ? event.error.message : \"\");\n    };\n\n    const paymentIntent = async (e) => {\n        e.preventDefault();\n\n        window\n            .fetch(\"http://localhost:3001/create-payment-intent\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({items: [{price: props.price}]})\n            })\n            .then(res => {\n\n                return res.json();\n\n            })\n            .then(data => {\n                console.log(\"payment intent created\" + data.clientSecret)\n                handleSubmit(data.clientSecret);\n            });\n    }\n\n    const handleSubmit = async (clientSecret) => {\n        console.log(\"confirming payment\")\n        setProcessing(true);\n        const payload = await stripe.confirmCardPayment(clientSecret, {\n            payment_method: {\n                card: elements.getElement(CardElement)\n            }\n        });\n        if (payload.error) {\n            setError(`Payment failed ${payload.error.message}`);\n            setProcessing(false);\n        } else {\n\n            setError(null);\n            setProcessing(false);\n            setSucceeded(true);\n            handleForm();\n        }\n    };\n\n    const goHome = () => {\n        history.push(\"/\")\n    }\n\n    const handleForm = () => {\n\n        props.form();\n    }\n    return (\n        <form id=\"payment-form\" onSubmit={paymentIntent}>\n            <CardElement id=\"card-element\" options={cardStyle} onChange={handleChange} />\n            <div className={succeeded ? \"p-4 row justified-content-center result-message hidden\" : \"p-4 row justified-content-center result-message\"}>\n                <button\n                    disabled={processing || disabled || succeeded}\n                    className=\"col btn btn-primary\"\n                >\n        <span id=\"button-text\">\n          {processing ? (\n              <div className=\"spinner\" id=\"spinner\"></div>\n          ) : (\n              \"Post Job Ad\"\n          )} ${props.price / 100}\n        </span>\n                </button>\n            </div>\n            {/* Show any error that happens when processing the payment */}\n            {error && (\n                <div className=\"card-error\" role=\"alert\">\n                    {error}\n                </div>\n            )}\n            {/* Show a success message upon completion */}\n            <div className={succeeded ? \"p-4 justify-content-center result-message\" : \"p-4 justify-content-center result-message hidden\"}>\n                <div class=\"row\">\n                    <button className=\"btn btn-primary\" onClick={goHome}>\n                        Home.\n                    </button>\n                </div>\n                <div class=\"row\">\n                    <p>\n                        Payment succeeded! View your new listing on the Home page! An order summary will be emailed to you.\n                    </p>\n                </div>\n            </div>\n\n        </form>\n    );\n}\n\nexport default CheckoutForm\n"]},"metadata":{},"sourceType":"module"}